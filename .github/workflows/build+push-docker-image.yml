name: build+push-docker-image
on: [push]
jobs:
  build:
    runs-on: macos-13-xlarge
    steps:
    - uses: actions/checkout@v2
    - name: build
      run: docker build -t ${{ github.repository }}:${{ github.sha }} .
    - name: Login to GitHub Container Registry
      run: echo "${{ secrets.GITHUB_TOKEN }}" | docker login ghcr.io -u ${{ github.actor }} --password-stdin
    - name: Tag Docker image
      run: docker tag ${{ github.repository }}:${{ github.sha }} ${{ github.repository }}:latest
    - name: Push Docker image
      run: |
        docker push ${{ github.repository }}:${{ github.sha }}
        docker push ${{ github.repository }}:latest
        
